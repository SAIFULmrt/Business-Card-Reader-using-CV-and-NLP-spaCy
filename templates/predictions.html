{% extends 'index.html' %} {% block head %}
<script src="https://apis.google.com/js/api.js"></script>
{% endblock head %} {% block script %}
<script src="https://apis.google.com/js/api.js"></script>
<script src="https://cdn.jsdelivr.net/g/filesaver.js/1.3.3/FileSaver.min.js"></script>

{% endblock script %} {% block body %}
<br /><br />

<div class="row">
  <div class="col">
    <img
      class="img-fluid border border-primary"
      src="/static/media/magic_color.jpg"
      alt="magic color image"
    />
    <p style="text-align: center">Magic Color Image</p>
  </div>
  <div class="col">
    <img
      class="img-fluid border border-primary"
      src="/static/media/bounding_box.jpg"
      alt="bounding box image"
    />
    <p style="text-align: center">Bounding Box Image</p>
  </div>
</div>

<!--Results showing in Table-->
<br /><br />
<div class="row">
  <table class="table table-hover table-dark">
    <thead>
      <tr>
        <th>Entities</th>
        <th>Extracted Text</th>
      </tr>
    </thead>

    <tbody>
      {% for key,value in results.items() %}
      <tr>
        <td>{{ key }}</td>
        <td>{{ value }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="row">
  <div class="col d-flex justify-content-center">
    <button class="btn btn-primary" id="copyData">
      Copy Extracted Data into Clipboard</button
    >&nbsp;&nbsp;
    <button class="btn btn-primary" id="saveData">
      Save Extracted Data into Local Machine
    </button>
  </div>
</div>

<script>
  const copyButton = document.getElementById("copyData");
  copyButton.addEventListener("click", () => {
    const resultsTable = document.querySelector("table");
    const textToCopy = resultsTable.innerText;
    navigator.clipboard.writeText(textToCopy);
    alert("Extracted data copied to clipboard!");
  });
</script>

<script>

      const saveButton = document.getElementById('saveData');

      saveButton.addEventListener('click', () => {

          alert('Extracted data saved as data.json');
          const resultsJson = ({{ results | tojson
      }})

      const jsonBlob = new Blob([JSON.stringify(resultsJson)], { type: "application/json" });

      // Convert JSON to a data URI
      const jsonUri = "data:application/json;charset=utf-8," + encodeURIComponent(JSON.stringify(resultsJson));

      // Create a temporary anchor element to trigger the download
      const a = document.createElement('a');
      a.href = jsonUri;
      a.download = 'data.json';
      a.style.display = 'none';

      // Append the anchor element to the document and trigger a click event
      document.body.appendChild(a);
      a.click();

      // Clean up by removing the anchor element
      document.body.removeChild(a);

      alert('Extracted data saved as data.json');
  });
</script>

{% endblock %}
